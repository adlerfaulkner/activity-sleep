<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script>
		var authCodeBaseUrl = "https://login.live.com/oauth20_authorize.srf";
		var authTokenBaseUrl = "https://login.live.com/oauth20_token.srf";
		var client_id = "a733911e-7922-4ba1-97a1-dd24ff4cb402";
		var secret = "Fa9cOdKgDtA8TavdB1OZ1AM";
		var redirect_uri = "https://adlerfaulkner.github.io/activity-sleep/index";
		var scope = "mshealth.ReadProfile";
		var code = "";

		$(document).ready( function() {
			addMethod();
			setTimeout( authorize, 300);
		});

		function authorize() {
			if (location.search.indexOf('code=') >= 0) {
				code = location.href.substring(location.href.indexOf('code=') + 5)
				getAuthToken();
			} else if (location.href.indexOf('/index') < 0) {
				getAuthCode();
			} else {
				return;
			}
		}

		function getAuthCode() {
			window.location.href = authCodeBaseUrl +
			 '?client_id=' + client_id +
				'&scope=' + scope +
				'&redirect_uri=' + redirect_uri +
				'&response_type=code';
		}
		function getAuthToken() {
			// $.post({
 		// 		'url': authTokenBaseUrl,
 		// 		'data': {
 		// 			'client_id': client_id,
 		// 			'redirect_uri': redirect_uri,
 		// 			'client_secret': secret,
 		// 			'code': code,
 		// 			'grant_type': 'authorization_code'
 		// 		},
 		// 		'dataType': 'json',
 		// 		'success': function(data, status, xhr) {
 		// 			console.log(data);
 		// 			console.log(status);
 		// 			console.log(xhr);
 		// 		}
 		// 	});
			$.form(
				authTokenBaseUrl,
				{
					'client_id': client_id,
 					'redirect_uri': redirect_uri,
 					'client_secret': secret,
 					'code': code,
 					'grant_type':'authorization_code'
				}
			).submit();
		}
		function addMethod() {
			jQuery(function($) { $.extend({
		    form: function(url, data, method) {
		        if (method == null) method = 'POST';
		        if (data == null) data = {};

		        var form = $('<form>').attr({
		            method: method,
		            action: url
		         }).css({
		            display: 'none'
		         });

		        var addData = function(name, data) {
		            if ($.isArray(data)) {
		                for (var i = 0; i < data.length; i++) {
		                    var value = data[i];
		                    addData(name + '[]', value);
		                }
		            } else if (typeof data === 'object') {
		                for (var key in data) {
		                    if (data.hasOwnProperty(key)) {
		                        addData(name + '[' + key + ']', data[key]);
		                    }
		                }
		            } else if (data != null) {
		                form.append($('<input>').attr({
		                  type: 'hidden',
		                  name: String(name),
		                  value: String(data)
		                }));
		            }
		        };
		        for (var key in data) {
		            if (data.hasOwnProperty(key)) {
		                addData(key, data[key]);
		            }
		        }
		        return form.appendTo('body');
			    }
				});
			});
		}
	</script>
</head>
<body>

<div>
	<h1>Activity Levels Effect on Sleep</h1>
	<p>Study by Adler Faulkner and Ross Workman</p>
</div>

<div>
	<h2>Abstract</h2>
	<p>First paragraph...</p>
</div>

<div>
	<h2>Deets.</h2>
	<p>Second paragraph...</p>
</div>

</body>
</html>
